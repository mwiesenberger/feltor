<!-- HTML header for doxygen 1.9.3-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Extension: Json and NetCDF utilities: The Probes diagnostics module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
    <!-- ... doxygen-awesome Fragment copy ... -->
    <script type="text/javascript" src="doxygen-awesome-fragment-copy-button.js"></script>
    <script type="text/javascript">
        DoxygenAwesomeFragmentCopyButton.init()
    </script>
    <!-- ... End doxygen-awesome Fragment copy ... -->
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
window.MathJax = {
  options: {
    ignoreHtmlClass: 'tex2jax_ignore',
    processHtmlClass: 'tex2jax_process'
  }
};
</script>
<script type="text/javascript" id="MathJax-script" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-fragment-copy-button.js" rel="stylesheet" type="text/css"/>
<link href="menubar.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Make a nice link to github (copied from doxygen-awesome/doxygen-custom/header.html-->
<!-- https://tholman.com/github-corners/ -->
<a href="https://github.com/feltor-dev/feltor" class="github-corner" title="View source on GitHub" target="_blank">
    <svg viewBox="0 0 250 250" width="80" height="80" style="position: absolute; top: 0; border: 0; right: 0; z-index: 99;" aria-hidden="true">
    <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
<!-- End Make a nice link to github -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
    <!--My own title area-->
  <ul class="menubar">
      <!-- <li><a href="../../../index.html">/</a><li>-->
    <li><a href="../../dg/html/topics.html">dg</a></li>
    <li><a href="../../geometries/html/topics.html">dg::geo</a></li>
    <li><a href="../../file/html/topics.html">dg::file</a></li>
    <li><a href="../../exblas/html/namespacedg_1_1exblas.html">dg::exblas</a></li>
    <li><a href="../../matrix/html/topics.html">dg::mat</a></li>
  </ul>
  <!--End My own title area-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Extension: Json and NetCDF utilities
   </div>
   <div id="projectbrief">#include &quot;dg/file/file.h&quot;</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('group__probes.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">The Probes diagnostics module<div class="ingroups"><a class="el" href="group__high.html">A high level C++ interface to NetCDF-4</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for The Probes diagnostics module:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__probes.svg" width="427" height="51"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdg_1_1file_1_1_probes.html">dg::file::Probes&lt; NcFile, Topology &gt;</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Facilitate output at selected points.  <a href="structdg_1_1file_1_1_probes.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structdg_1_1file_1_1_probes_params.html">dg::file::ProbesParams</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parameter struct for probe values.  <a href="structdg_1_1file_1_1_probes_params.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga47fa71c0f05e09a4deaa3737bf66962e" id="r_ga47fa71c0f05e09a4deaa3737bf66962e"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structdg_1_1file_1_1_probes_params.html">ProbesParams</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ga47fa71c0f05e09a4deaa3737bf66962e">dg::file::parse_probes</a> (const <a class="el" href="structdg_1_1file_1_1_wrapped_json_value.html">dg::file::WrappedJsonValue</a> &amp;js, enum <a class="el" href="group__wrapper.html#gaa175872f0039fffca9e16b101f605e8a">error</a> probes_err=<a class="el" href="group__wrapper.html#ggaa175872f0039fffca9e16b101f605e8aa860c46d6e55990284b48131ef9e0b282">file::error::is_silent</a>)</td></tr>
<tr class="memdesc:ga47fa71c0f05e09a4deaa3737bf66962e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parse probe field in json file for use with <a class="el" href="structdg_1_1file_1_1_probes.html" title="Facilitate output at selected points.">Probes</a> class.  <br /></td></tr>
<tr class="separator:ga47fa71c0f05e09a4deaa3737bf66962e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Function Documentation</h2>
<a id="ga47fa71c0f05e09a4deaa3737bf66962e" name="ga47fa71c0f05e09a4deaa3737bf66962e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga47fa71c0f05e09a4deaa3737bf66962e">&#9670;&#160;</a></span>parse_probes()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structdg_1_1file_1_1_probes_params.html">ProbesParams</a> dg::file::parse_probes </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structdg_1_1file_1_1_wrapped_json_value.html">dg::file::WrappedJsonValue</a> &amp;</td>          <td class="paramname"><span class="paramname"><em>js</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">enum <a class="el" href="group__wrapper.html#gaa175872f0039fffca9e16b101f605e8a">error</a></td>          <td class="paramname"><span class="paramname"><em>probes_err</em></span><span class="paramdefsep"> = </span><span class="paramdefval"><a class="el" href="group__wrapper.html#ggaa175872f0039fffca9e16b101f605e8aa860c46d6e55990284b48131ef9e0b282">file::error::is_silent</a></span>&#160;)</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parse probe field in json file for use with <a class="el" href="structdg_1_1file_1_1_probes.html" title="Facilitate output at selected points.">Probes</a> class. </p>
<p>A synthetic diagnostics in FELTOR is equivalent to outputting the computational fields including their first derivatives in time interpolated to any grid location (as if a measurement was done at that location). The output frequency is typically higher than the output frequency of the entire computation fields (otherwise you could just interpolate those at the end of the simulation).</p>
<p>In the input file, it is required to define the interpolation coordinates named <code>coords-names</code> (in this example "R", "Z" and "P") as arrays. The length of the position arrays must match each other. There is no limit on the size of the arrays; they are typically not performance relevant unless a large percentage of actual grid coordinates is reached </p><div class="fragment"><div class="line"><span class="stringliteral">&quot;probes&quot;</span> :</div>
<div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;input&quot;</span> : <span class="stringliteral">&quot;coords&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;coords&quot;</span> :</div>
<div class="line">    {</div>
<div class="line">        <span class="stringliteral">&quot;format&quot;</span> : format, <span class="comment">// see paragraph below</span></div>
<div class="line">        <span class="stringliteral">&quot;coords-names&quot;</span> : [<span class="stringliteral">&quot;R&quot;</span>,<span class="stringliteral">&quot;Z&quot;</span>,<span class="stringliteral">&quot;P&quot;</span>], <span class="comment">// name of coordinates ( need to be in order passed to interpolation function)</span></div>
<div class="line">        <span class="stringliteral">&quot;R&quot;</span>: [90, 95, 100], <span class="comment">// R coordinates in rho\_s</span></div>
<div class="line">        <span class="stringliteral">&quot;Z&quot;</span>: [0, 0, 0], <span class="comment">// Z coordinates in rho\_s</span></div>
<div class="line">        <span class="stringliteral">&quot;P&quot;</span>: [0, 0, 3] <span class="comment">// phi coordinates in radian (values outside the interval</span></div>
<div class="line">        <span class="comment">// $[0,2\pi]$ will be taken modulo $2\pi$ (unsigned))</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> The "coords" field can be read from an external json file alternatively using </p><div class="fragment"><div class="line"><span class="stringliteral">&quot;probes&quot;</span> :</div>
<div class="line">{</div>
<div class="line">    <span class="stringliteral">&quot;input&quot;</span> : <span class="stringliteral">&quot;file&quot;</span>,</div>
<div class="line">    <span class="stringliteral">&quot;file&quot;</span> : <span class="stringliteral">&quot;path/to/file.json&quot;</span>, <span class="comment">// relative to where the program is executed from</span></div>
<div class="line">    <span class="stringliteral">&quot;scale&quot;</span> : [1000,1000,1] <span class="comment">// convert coords from SI units to dimenless units</span></div>
<div class="line">}</div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>By default the "probes" input field is optional and can be left away entirely. No probes will be written into the output file then. Be sure not to have any spelling mistakes on "probes" if you do want them though.</dd></dl>
<p>All measurements from points, lines, surfaces and volumes with different purposes and different diagnostics, must be concatenated and flattened into the one-dimensional coordinate arrays and the measurements are written to file as one-dimensional arrays. In this way the book-keeping "which point belongs
   to which diagnostics and is neighbor to which other point" may become challening. This is why the "format" field exists.</p>
<p>The format value is a user-defined json value that is ignored by feltor, converted to a styled string and then stored as an attribute to the probes group in the output file. Its purpose is to hold parsing information for the (flat) \( R \), \( Z \), \( P \) arrays for post-processing. For example </p><div class="fragment"><div class="line"><span class="stringliteral">&quot;format&quot;</span> : [</div>
<div class="line">{<span class="stringliteral">&quot;name&quot;</span> : <span class="stringliteral">&quot;x-probe&quot;</span>, <span class="stringliteral">&quot;pos&quot;</span> : [0,10], <span class="stringliteral">&quot;shape&quot;</span> : [10]},</div>
<div class="line">{<span class="stringliteral">&quot;name&quot;</span> : <span class="stringliteral">&quot;omp&quot;</span>, <span class="stringliteral">&quot;pos&quot;</span> : [10,1010], <span class="stringliteral">&quot;shape&quot;</span> : [10,10,10]}</div>
<div class="line">]</div>
</div><!-- fragment --><p> interprets the first ten points in the probes array as a linear "x-probe" line, while the remaining 1000 points belong to a 3d measurement volume called "omp". From this information e.g. array views can be easily created in python: </p><div class="fragment"><div class="line">named_arr = dict()</div>
<div class="line">for f in format:</div>
<div class="line">    named_arr[f[&quot;name&quot;]] = arr[f[&quot;pos&quot;][0]:f[&quot;pos&quot;][1]].reshape( f[&quot;shape&quot;])</div>
</div><!-- fragment --><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">js</td><td>input json value </td></tr>
    <tr><td class="paramname">probes_err</td><td>what to do if "probes" is missing from <code>js</code> (overwrites js error mode) If silent, the <a class="el" href="structdg_1_1file_1_1_probes_params.html" title="Parameter struct for probe values.">ProbesParams</a> remain empty if the field is absent </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>parsed values </dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>In MPI all threads will read in the probes. Only the master thread stores the coordinates in <code><a class="el" href="structdg_1_1file_1_1_probes_params.html#a0bf441f54d0c012cf3167bf4c2cc95c1" title="Coordinates list.">ProbesParams.coords</a>[i]</code> the others are empty (and thus also the <code><a class="el" href="structdg_1_1file_1_1_probes_params.html#a47fd5493a1cf839d191124fd524dd28b" title="Check that coords all have same size and return that size.">ProbesParams.get_coords_sizes()</a></code> function will return zero on non-master ranks) </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__probes_ga47fa71c0f05e09a4deaa3737bf66962e_cgraph.svg" width="694" height="183"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.3-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Mon Jun 23 2025 12:36:39 for Extension: Json and NetCDF utilities by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
